"use strict";function write(a,b){return fs.writeFile(b,a,function(a){a&&console.error(a)})}function stream(a,b,c){var d=b.res||b;d.header("Content-Type",c),d.send(a)}function sitemap(a){return new SITEMAP(a)}function SITEMAP(a){var b=a||Object.create(null),c="https"==b.http?"https://":"http://",d=String(b.url||"127.0.0.1"),e=Number(b.port)?":"+Number(b.port):"";this.my={url:c+d+e,sitemap:String(b.sitemap||"sitemap.xml"),robots:String(b.robots||"robots.txt"),route:"object"==typeof b.route?b.route:Object.create(null)},this.my.sitemap=resolve(this.my.sitemap),this.my.robots=resolve(this.my.robots),this.map="object"==typeof b.map?b.map:Object.create(null),b.generate&&b.generate._router&&this.generate(b.generate)}try{var fs=require("fs"),resolve=require("path").resolve}catch(MODULE_NOT_FOUND){console.error(MODULE_NOT_FOUND),process.exit(1)}module.exports=sitemap,SITEMAP.prototype.generate=function(a){for(var b=this.map,c=a._router.stack,d=0,e=c.length;e>d;d++){var f=c[d].route;if(f){var g=f.path;f.methods.get&&(b[g]=["get"])}}return b},SITEMAP.prototype.tickle=function(){if(GLOBAL.tickle&&GLOBAL.tickle.route){var a=this.map,b=GLOBAL.tickle.route;for(var c in b)a[c]=[];return a}return Object.create(null)},SITEMAP.prototype.reset=function(){this.map=Object.create(null)},SITEMAP.prototype.xml=function(){var a=this.my.route,b=this.map,c='<?xml version="1.0" encoding="UTF-8"?>';c+='<urlset xmlns="http://www.sitemaps.org/schemas/sitemap/0.9">';for(var d in b){var e=a.ALL||a[d]||!1;e&&(e.disallow||e.hide)||(c+="<url>",c+="<loc>",c+=this.my.url,c+=d,c+="</loc>",e&&(e.lastmod&&(c+="<lastmod>",c+=e.lastmod,c+="</lastmod>"),e.changefreq&&(c+="<changefreq>",c+=e.changefreq,c+="</changefreq>"),e.priority&&(c+="<priority>",c+=e.priority,c+="</priority>")),c+="</url>")}return c+="</urlset>"},SITEMAP.prototype.robots=function(){var a=!0,b=this.my.route,c=this.map,d="User-agent: *\n";for(var e in c){var f=b[e];if(b.ALL&&b.ALL.disallow&&!b.ALL.hide){a=!1,d+="Disallow: /\n";break}f&&f.disallow&&!f.hide&&(a=!1,d+="Disallow: ",d+=e,d+="\n")}return a&&(d+="Disallow: \n"),d},SITEMAP.prototype.XMLtoFile=function(){return write(this.xml(),this.my.sitemap)},SITEMAP.prototype.TXTtoFile=function(){return write(this.robots(),this.my.robots)},SITEMAP.prototype.toFile=function(){write(this.xml(),this.my.sitemap),write(this.robots(),this.my.robots)},SITEMAP.prototype.XMLtoWeb=function(a){return stream(this.xml(),a,"application/xml")},SITEMAP.prototype.TXTtoWeb=function(a){return stream(this.robots(),a,"text/plain")};
