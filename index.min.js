/*
 * express-sitemap v1.3.3
 * (c) hex7c0 http://supergiovane.tk/#/express-sitemap
 * Licensed under GPLv3
 */
"use strict";function write(a,b){return fs.writeFile(b,a,function(a){a&&console.error(a)})}function stream(a,b,c){var d=b.res||b;d.header("Content-Type",c),d.send(a)}function SITEMAP(a){a=a||Object.create(null);var b="https"==a.http?"https://":"http://",c=String(a.url||"127.0.0.1"),d=Number(a.port)?":"+Number(a.port):"";this.my={url:b+c+d,sitemap:String(a.sitemap||"sitemap.xml"),robots:String(a.robots||"robots.txt"),route:"object"==typeof a.route?a.route:Object.create(null)},this.my.sitemap=resolve(this.my.sitemap),this.my.robots=resolve(this.my.robots),this.map="object"==typeof a.map?a.map:Object.create(null),a.generate&&a.generate._router&&this.generate(a.generate)}try{var fs=require("fs"),resolve=require("path").resolve}catch(MODULE_NOT_FOUND){console.error(MODULE_NOT_FOUND),process.exit(1)}module.exports=function(a){return new SITEMAP(a)},SITEMAP.prototype.generate=function(a){for(var b=this.map,c=a._router.stack,d=0,e=c.length;e>d;d++){var f=c[d].route;if(f){var g=f.path;f.methods.get&&(b[g]=["get"])}}return b},SITEMAP.prototype.tickle=function(){if(GLOBAL.tickle&&GLOBAL.tickle.route){var a=this.map,b=GLOBAL.tickle.route;for(var c in b)a[c]=[];return a}return Object.create(null)},SITEMAP.prototype.reset=function(){this.map=Object.create(null)},SITEMAP.prototype.xml=function(){var a=null,b=this.my.route,c=this.map,d='<?xml version="1.0" encoding="UTF-8"?>';d+='<urlset xmlns="http://www.sitemaps.org/schemas/sitemap/0.9">';for(var e in c){var f=b.ALL||b[e]||!1;f&&(f.disallow||f.hide)||(d+="<url>",d+="<loc>",d+=this.my.url,d+=e,d+="</loc>",f&&((a=f.lastmod)&&(d+="<lastmod>",d+=a,d+="</lastmod>"),(a=f.changefreq)&&(d+="<changefreq>",d+=a,d+="</changefreq>"),(a=f.priority)&&(d+="<priority>",d+=a,d+="</priority>")),d+="</url>")}return d+="</urlset>"},SITEMAP.prototype.robots=function(){var a=!0,b=this.my.route,c=this.map,d="User-agent: *\n";for(var e in c){var f=b[e];if(b.ALL&&b.ALL.disallow&&!b.ALL.hide){a=!1,d+="Disallow: /\n";break}f&&f.disallow&&!f.hide&&(a=!1,d+="Disallow: ",d+=e,d+="\n")}return a&&(d+="Disallow: \n"),d},SITEMAP.prototype.XMLtoFile=function(){return write(this.xml(),this.my.sitemap)},SITEMAP.prototype.TXTtoFile=function(){return write(this.robots(),this.my.robots)},SITEMAP.prototype.toFile=function(){write(this.xml(),this.my.sitemap),write(this.robots(),this.my.robots)},SITEMAP.prototype.XMLtoWeb=function(a){return stream(this.xml(),a,"application/xml")},SITEMAP.prototype.TXTtoWeb=function(a){return stream(this.robots(),a,"text/plain")};
